# **Лабораторная работа. Настройка HSRP**

### Топология

![HSRP](.\HSRP.png)



### Таблица адресации

| Устройство   | Интерфейс       | IP-адрес        | Маска подсети   | Шлюз по умолчанию |
| ------------ | --------------- | --------------- | --------------- | ----------------- |
| R1           | G0/1            | 192.168.1.1     | 255.255.255.0   | —                 |
| S0/0/0 (DCE) | 10.1.1.1        | 255.255.255.252 | —               |                   |
| R2           | S0/0/0          | 10.1.1.2        | 255.255.255.252 | —                 |
| S0/0/1 (DCE) | 10.2.2.2        | 255.255.255.252 | —               |                   |
| Lo1          | 209.165.200.225 | 255.255.255.224 | —               |                   |
| R3           | G0/1            | 192.168.1.3     | 255.255.255.0   | —                 |
| S0/0/1       | 10.2.2.1        | 255.255.255.252 | —               |                   |
| S1           | VLAN 1          | 192.168.1.11    | 255.255.255.0   | 192.168.1.1       |
| S3           | VLAN 1          | 192.168.1.13    | 255.255.255.0   | 192.168.1.3       |
| PC-A         | NIC             | 192.168.1.31    | 255.255.255.0   | 192.168.1.1       |
| PC-C         | NIC             | 192.168.1.33    | 255.255.255.0   | 192.168.1.3       |

### **Задачи**

**1. Построение сети и проверка соединения**

**2. Настройка обеспечения избыточности на первом хопе с помощью HSRP**

### **Общие сведения/сценарий**

Связующее дерево обеспечивает резервирование коммутаторами в локальной сети, не допуская возникновения петель. Но оно не позволяет организовать в сети резервирование шлюзов по умолчанию для устройств конечных пользователей на случай сбоя одного из маршрутизаторов. Протоколы обеспечения избыточности на первом хопе (First Hop Redundancy Protocols, FHRP) предоставляют избыточные шлюзы по умолчанию для конечных устройств. При этом конфигурация конечного пользователя не требуется. В этой лабораторной работе вам предстоит настроить протокол Cisco HSRP, являющийся протоколом FHRP.

**Примечание**. В практических лабораторных работах CCNA используются маршрутизаторы с интегрированными сетевыми сервисами (ISR) Cisco 1941 с операционной системой Cisco IOS версии 15.2(4)M3 (образ universalk9). Также используются коммутаторы Cisco Catalyst 2960 с операционной системой Cisco IOS версии 15.0(2) (образ lanbasek9). Можно использовать другие маршрутизаторы, коммутаторы и версии Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. Точные идентификаторы интерфейсов см. в сводной таблице по интерфейсам маршрутизаторов в конце лабораторной работы.

**Примечание**. Убедитесь, что у маршрутизаторов и коммутаторов были удалены начальные конфигурации. Если вы не уверены, обратитесь к инструктору.

**Необходимые ресурсы**

- 3 маршрутизатора (Cisco 1941 с операционной системой Cisco IOS версии 15.2(4)M3 (универсальный образ) или аналогичная модель)
- 2 коммутатора (Cisco 2960 с операционной системой Cisco IOS 15.0(2) (образ lanbasek9) или аналогичная модель)
- 2 компьютера (Windows 8, 7 или Vista с программой эмуляции терминала, например Tera Term)
- Консольные кабели для настройки устройств Cisco IOS через консольные порты
- Кабели Ethernet и последовательные кабели согласно топологии

## 1. Построение сети и проверка связи

В первой части вам предстоит настроить топологию сети и выполнить базовую настройку, например IP-адреса интерфейсов, статическую маршрутизацию, доступ к устройствам и пароли.

#### 1.1 Создайте сеть 	согласно топологии.

Подключите устройства, как показано в топологии, и подсоедините необходимые кабели.

#### 1.2 Настройте узлы ПК.

#### 1.3 Выполните инициализацию 	и перезагрузку маршрутизатора 	и коммутаторов.

#### 1.4 Произведите базовую 	настройку маршрутизаторов.

Отключите поиск DNS.

Присвойте имена устройствам в соответствии с топологией.

Настройте IP-адреса для маршрутизаторов, указанных в таблице адресации.

Установите тактовую частоту на **128000** для всех последовательных интерфейсов 		маршрутизатора DCE.

Назначьте **class** в качестве зашифрованного пароля доступа к привилегированному режиму.

Назначьте **cisco** в качестве пароля консоли и VTY и включите запрос пароля при 		подключении.

Настройте **logging synchronous**, чтобы сообщения от консоли не могли прерывать ввод команд.

Скопируйте текущую конфигурацию в файл загрузочной конфигурации.

#### 1.5 Настройте базовые 	параметры каждого коммутатора.

Отключите поиск DNS.

Присвойте имена устройствам в соответствии с топологией.

Назначьте **class** в качестве зашифрованного пароля доступа к привилегированному режиму.

Настройте IP-адреса для коммутаторов, указанных в таблице адресации.

На каждом коммутаторе настройте шлюз по умолчанию.

Назначьте **cisco** в качестве пароля консоли и VTY и включите запрос пароля при 		подключении.

Настройте **logging synchronous**, чтобы сообщения от консоли не могли прерывать ввод команд.

Скопируйте текущую конфигурацию в файл загрузочной конфигурации.

#### 1.6 Проверьте подключение между PC-A и PC-C.

*Отправьте ping-запрос с компьютера PC-A на компьютер PC-C. Удалось ли получить ответ?* 



Если команды ping завершились неудачно и связь установить не удалось, исправьте ошибки в основных настройках устройства.

**Примечание.** Для успешной передачи эхо-запросов может потребоваться отключение брандмауэра.

#### 1.7 Настройте маршрутизацию.

Настройте RIP версии 2 на всех маршрутизаторах. Добавьте в процесс RIP все сети, кроме 		209.165.200.224/27.

Настройте маршрут по умолчанию на маршрутизаторе R2 с использованием Lo1 в качестве 		интерфейса выхода в сеть 209.165.200.224/27.

На маршрутизаторе R2 используйте следующие команды для перераспределения маршрута по умолчанию в процесс RIP.

```
R2(config)# router rip

R2(config-router)# default-information originate
```

#### 1.8 Проверьте подключение.

*Необходимо получить ответ на ping-запросы с компьютера PC-A от каждого интерфейса на маршрутизаторах R1, R2 и R3, а также от компьютера PC-C. Удалось ли получить все ответы?* 		



Если команды ping завершились неудачно и связь установить не удалось, исправьте ошибки в основных настройках устройства.



*Необходимо получить ответ на ping-запросы с компьютера PC-C от каждого интерфейса на маршрутизаторах R1, R2 и R3, а также от компьютера PC-A. Удалось ли получить все ответы?*

 		

Если команды ping завершились неудачно и связь установить не удалось, исправьте ошибки в основных настройках устройства.

## 2. Настройка обеспечения избыточности на первом хопе с помощью HSRP

Даже если топология спроектирована с учетом избыточности (два маршрутизатора и два коммутатора в одной сети LAN), оба компьютера, PC-A и PC-C, необходимо настраивать с одним адресом шлюза. PC-A использует R1, а PC-C — R3. В случае сбоя на одном из этих маршрутизаторов или интерфейсов маршрутизаторов компьютер может потерять подключение к сети Интернет.

В части 2 вам предстоит изучить поведение сети до и после настройки протокола HSRP. Для этого вам понадобится определить путь, по которому проходят пакеты, чтобы достичь loopback-адрес на R2.

#### 2.1 Определите путь интернет-трафика для PC-A и PC-C.

В командной строке на PC-A введите команду **tracert** для loopback-адреса 209.165.200.225 на маршрутизаторе R2.

```
C:\ tracert 209.165.200.225

Tracing route to 209.165.200.225 over a maximum of 30 hops
 
  1    1 ms     1 ms     1 ms  192.168.1.1

  2   13 ms    13 ms    13 ms  209.165.200.225

Trace complete.
```

*Какой путь прошли пакеты от PC-A до 209.165.200.225?*



В командной строке на PC-С введите команду **tracert** для loopback-адреса 209.165.200.225 на маршрутизаторе R2.

*Какой путь прошли пакеты от PC-C до 209.165.200.225?*



#### 2.2 Запустите сеанс 	эхо-тестирования на PC-A и разорвите 	соединение между S1 и R1.

В командной строке на PC-A введите команду **ping –t** для адреса **209.165.200.225** на маршрутизаторе R2. Убедитесь, что окно командной строки открыто.

**Примечание**. Чтобы прервать отправку эхо-запросов, нажмите комбинацию клавиш **Ctrl**+**C** или закройте окно командной строки.

```
C:\ ping –t 209.165.200.225

Pinging 209.165.200.225 with 32 bytes of data:

Reply from 209.165.200.225: bytes=32 time=9ms TTL=254

Reply from 209.165.200.225: bytes=32 time=9ms TTL=254

Reply from 209.165.200.225: bytes=32 time=9ms TTL=254

<выходные данные опущены>
```

В процессе эхо-тестирования отсоедините кабель Ethernet от интерфейса F0/5 на S1. Отключение интерфейса F0/5 на S1 приведет к тому же результату.

*Что произошло с трафиком эхо-запросов?*



*Какими были бы результате при повторении шагов 2a и 2b на компьютере PC-C и коммутаторе 		S3?*



Повторно подсоедините кабели Ethernet к интерфейсу F0/5 или включите интерфейс F0/5 на S1 и S3, соответственно. Повторно отправьте эхо-запросы на 209.165.200.225 с компьютеров PC-A и PC-C, чтобы убедиться в том, что подключение восстановлено.

#### 2.3 Настройте HSRP на R1 и R3.

В этом шаге вам предстоит настроить HSRP и изменить адрес шлюза по умолчанию на компьютерах PC-A, PC-C, S1 и коммутаторе S2 на виртуальный IP-адрес для HSRP. R1 назначается активным маршрутизатором с помощью команды приоритета HSRP.

Настройте протокол HSRP на маршрутизаторе R1.

```
R1(config)# interface g0/1

R1(config-if)# standby version 2

R1(config-if)# standby 1 ip 192.168.1.254

R1(config-if)# standby 1 priority 150

R1(config-if)# standby 1 preempt
```

Настройте протокол HSRP на маршрутизаторе R3.

```
R3(config)# interface g0/1

R3(config-if)# standby version 2

R3(config-if)# standby 1 ip 192.168.1.254
```

Проверьте HSRP, выполнив команду **show standby** на R1 и R3.

```
R1# show standby

GigabitEthernet0/1 - Group 1 (version 2)

  State is Active

​    4 state changes, last state change 0:00:30

  Virtual IP address is 192.168.1.254

  Active virtual MAC address is 0000.0c9f.f001

​    Local virtual MAC address is 0000.0c9f.f001 (v2 default)

  Hello time 3 sec, hold time 10 sec

​    Next hello sent in 1.696 secs

  Preemption enabled

  Active router is local

  Standby router is 192.168.1.3, priority 100 (expires in 11.120 sec)

  Priority 150 (configured 150)

  Group name is "hsrp-Gi0/1-1" (default)


R3# show standby

GigabitEthernet0/1 - Group 1 (version 2)

  State is Standby

​    4 state changes, last state change 0:02:29

  Virtual IP address is 192.168.1.254

  Active virtual MAC address is 0000.0c9f.f001

​    Local virtual MAC address is 0000.0c9f.f001 (v2 default)

  Hello time 3 sec, hold time 10 sec

​    Next hello sent in 0.720 secs

  Preemption disabled

  Active router is 192.168.1.1, priority 150 (expires in 10.128 sec)

​    MAC address is d48c.b5ce.a0c1

  Standby router is local

  Priority 100 (default 100)

  Group name is "hsrp-Gi0/1-1" (default)
```

Используя указанные выше выходные данные, ответьте на следующие вопросы:

*Какой маршрутизатор является активным?*



*Какой MAC-адрес используется для виртуального IP-адреса?*



*Какой IP-адрес и приоритет используются для резервного маршрутизатора?*



Используйте команду **show standby brief** на R1 и R3, чтобы просмотреть сводку состояния HSRP. Выходные данные приведены ниже.

```
R1# show standby brief

​                    P indicates configured to preempt.

​                    |

Interface  Grp  Pri P State   Active          Standby         Virtual IP

Gi0/1      1    150 P Active  local           192.168.1.3     192.168.1.254

 
R3# show standby brief

​                    P indicates configured to preempt.

​                    |

Interface  Grp  Pri P State   Active          Standby         Virtual IP

Gi0/1      1    100   Standby 192.168.1.1     local           192.168.1.254
```

*Измените адрес шлюза по умолчанию для PC-A, PC-C, S1 и S3. Какой адрес следует использовать?*



*Проверьте новые настройки. Отправьте эхо-запрос с PC-A и с PC-C на loopback-адрес маршрутизатора R2. Успешно ли выполнены эхо-запросы?* 



#### 2.4 Запустите сеанс эхо-тестирования на PC-A и разорвите соединение с коммутатором, подключенным к активному маршрутизатору HSRP (R1).

В командной строке на PC-A введите команду **ping –t** для адреса 209.165.200.225 на маршрутизаторе R2. Убедитесь, что окно командной строки открыто.

Во время отправки эхо-запроса отсоедините кабель Ethernet от интерфейса F0/5 на коммутаторе S1 или выключите интерфейс F0/5.

*Что произошло с трафиком эхо-запросов?*



#### 2.5 Проверьте настройки HSRP на маршрутизаторах R1 и R3.

Выполните команду **show standby brief** на маршрутизаторах R1 и R3.

*Какой маршрутизатор является активным?*



*Повторно подключите кабель, соединяющий коммутатор и маршрутизатор, или включите интерфейс F0/5. Какой маршрутизатор теперь является активным? Поясните ответ.*



#### 2.6 Изменение приоритетов HSRP.

Измените приоритет HSRP на 200 на маршрутизаторе R3. Какой маршрутизатор является активным? 

Выполните команду, чтобы сделать активным маршрутизатор R3 без изменения приоритета. Какую команду вы использовали?

Используйте команду **show**, чтобы убедиться, что R3 является активным маршрутизатором.



## Вопросы для повторения

Для чего в локальной сети может потребоваться избыточность?